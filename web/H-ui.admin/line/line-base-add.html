<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!--[if lt IE 9]>
    <script type="text/javascript" src="../lib/html5shiv.js"></script>
    <script type="text/javascript" src="../lib/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="../static/h-ui/css/H-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/H-ui.admin.css"/>
    <link rel="stylesheet" type="text/css" href="../lib/Hui-iconfont/1.0.8/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="../static/h-ui.admin/skin/default/skin.css" id="skin"/>
    <link rel="stylesheet" type="text/css" href="../static/h-ui.admin/css/style.css"/>
    <!--[if IE 6]>
    <script type="text/javascript" src="../lib/DD_belatedPNG_0.0.8a-min.js"></script>
    <script>DD_belatedPNG.fix('*');</script>
    <![endif]-->
    <title>新增图片</title>
    <link href="../lib/webuploader/0.1.5/webuploader.css" rel="stylesheet" type="text/css"/>

    <!--_footer 作为公共模版分离出去-->
    <script type="text/javascript" src="../lib/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="../lib/layer/2.4/layer.js"></script>
    <script type="text/javascript" src="../static/h-ui/js/H-ui.min.js"></script>
    <script type="text/javascript" src="../static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer /作为公共模版分离出去-->

    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript" src="../lib/jquery.validation/1.14.0/jquery.validate.js"></script>
    <script type="text/javascript" src="../lib/jquery.validation/1.14.0/validate-methods.js"></script>
    <script type="text/javascript" src="../lib/jquery.validation/1.14.0/messages_zh.js"></script>
    <script type="text/javascript" src="../lib/webuploader/0.1.5/webuploader.min.js"></script>

    <script type="text/javascript" src="../../js/common-util.js"></script>
    <script type="text/javascript" src="./js/line-base.js"></script>
    
    
</head>
<body>
<div class="page-container">
    <div id="tab_demo" class="HuiTab">
        <div class="tabBar clearfix">
            <span>基本信息</span>
            <span>详情信息</span>
            <span>线路班次</span>
            <span>线路日程</span>
        </div>
        <div class="tabCon">
            <div class="form form-horizontal" id="form-article-add">
                <!--订单类型Head-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>线路名：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="线路名" id="tName" name="">
                    </div>
                </div>
                <!--订单类型End-->
                <!--交通方式预留 Head-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>交通方式：</label>
                    <div class="formControls col-xs-8 col-sm-9">
				<span class="select-box">
					<select name="" class="select" id="tTraffic">
						<option value="0">步行</option>
						<option value="1" id="asd">汽车</option>
						<option value="2">火车</option>
						<option value="3">飞机</option>
						<option value="4">轮船</option>
						<option value="9">其他</option>
					</select>
				</span>
                    </div>
                </div>
                <!--交通方式预留 End-->
                <!--旅游人数 Head-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>旅游人数：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入数字" id="tCount" name="">
                    </div>
                </div>
                <!--旅游人数 End-->
                <!--订单类型预留 Head-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>线路订单审核：</label>
                    <div class="formControls col-xs-8 col-sm-9">
				<span class="select-box">
					<select name="" class="select" id="tOrderType">
						<option value="0">不需要审核</option>
						<option value="1">需要审核</option>
					</select>
				</span>
                    </div>
                </div>
                <!--订单类型预留 End-->
                <!--线路类型 Head-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>线路类型：</label>
                    <div class="formControls col-xs-8 col-sm-9">
				<span class="select-box">
					<select name="" class="select" id="tType">
						<option value="0">周边游</option>
						<option value="1">国内游</option>
						<option value="2">国际游</option>
						<option value="3">自驾游</option>
						<option value="4">邮轮游</option>
					</select>
				</span>
                    </div>
                </div>
                <!--线路类型 End-->
                <!--旅游天数 Head-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>旅游天数：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入数字" id="tDay" name="">
                    </div>
                </div>
                <!--旅游天数 End-->
                <!--成人价格 Head-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>成人价格：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入数字" id="tPrice" name="">
                    </div>
                </div>
                <!--成人价格 End-->
                <!--儿童价格 Head-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>儿童价格：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入数字" id="tChildPrice" name="">
                    </div>
                </div>
                <!--儿童价格 End-->
                <!--交通方式 Head-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>线路状态：</label>
                    <div class="formControls col-xs-8 col-sm-9">
				<span class="select-box">
					<select name="" class="select" id="state">
						<option value="0">停止</option>
						<option value="1">正常</option>
					</select>
				</span>
                    </div>
                </div>
                <div class="row cl">
                    <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
                        <button onClick="insertLineBase();" class="btn btn-secondary radius" type="button">提交</button>
                        <button onClick="layer_close();" class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
                        <!--<button class="next-btn btn btn-primary f-r" onclick="toDetailEdit();">下一步</button>-->
                    </div>
                </div>
            </div>
        </div>
        <div class="tabCon">
            <script type="text/javascript" src="./js/line-detail.js"></script>
            <div class="form form-horizontal" id="">
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>副标题：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="" id="travel_subtitle" name="">
                    </div>
                </div>
                <!--副标题 End-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>线路特色：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                <textarea id="travel_feature" name="" cols="" rows="" class="textarea" placeholder="说点什么...最少输入10个字符"
                          datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！"></textarea>
                        <p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>线路提示：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                <textarea id="travel_tips" name="" cols="" rows="" class="textarea" placeholder="说点什么...最少输入10个字符"
                          datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！"
                          ></textarea>
                        <p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2" >新出发地：</label>
                    <div class="formControls col-xs-8 col-sm-2">
                        <select name="" class="selected" id="fromAreas" onchange="changeSonAresById(this, 'fromSonAreas')"></select>
                    </div>
                    <label class="form-label col-xs-4 col-sm-2" >新出发区：</label>
                    <div class="formControls col-xs-8 col-sm-2">
                        <select name="" class="selected" id="fromSonAreas" ></select>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">新目的地：</label>
                    <div class="formControls col-xs-8 col-sm-2">
                        <select name="" class="selected" id="toAreas" onchange="changeSonAresById(this, 'toSonAreas')"><option value="1">浙江</option><option value="2">西藏</option></select>
                    </div>
                    <label class="form-label col-xs-4 col-sm-2">新目的区：</label>
                    <div class="formControls col-xs-8 col-sm-2">
                        <select name="" class="selected" id="toSonAreas"></select>
                    </div>
                </div>
                <script>
                    $(function() {
                        initAreaInfo();
                    })
                </script>
                <div class="row cl hide">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>ID：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="" id="travel_id" name="" disabled="disabled">
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>浏览数：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="" id="travel_views" name="">
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>费用说明：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                <textarea id="travel_info" name="" cols="" rows="" class="textarea" placeholder="说点什么...最少输入10个字符"
                          datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！"
                          ></textarea>
                        <p class="textarea-numberbar"><em class="textarea-length">0</em>/200</p>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>预定信息：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                <textarea id="reserve_info" name="" cols="" rows="" class="textarea" placeholder="说点什么...最少输入10个字符"
                          datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！"></textarea>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>温馨提示：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                <textarea id="warm_prompt" name="" cols="" rows="" class="textarea" placeholder="说点什么...最少输入10个字符"
                          datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！"></textarea>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>全透明提示：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                <textarea id="open_info" name="" cols="" rows="" class="textarea" placeholder="说点什么...最少输入10个字符"
                          datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！"></textarea>
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2"><span class="c-red">*</span>目的地信息：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                <textarea id="to_info" name="" cols="" rows="" class="textarea" placeholder="说点什么...最少输入10个字符"
                          datatype="*10-100" dragonfly="true" nullmsg="备注不能为空！"></textarea>
                    </div>
                </div>
                <form action="/dd_travel_war/fileUpload" enctype="multipart/form-data" id="form1">
                    <div class="row cl">
                        <label class="form-label col-xs-4 col-sm-2">图片：</label>
                        <div class="formControls col-xs-8 col-sm-9" id="line_photos">
                            <div class="col-sm-3">
                                <img style="width: 200px;height: 200px;display: block;"
                                     src="" alt="未上传图片" id="travel_picture">
                                <span class="btn-upload form-group mt-20">
                            <input type="file" name="p1" onchange="" style=""/>
                        </span>
                            </div>
                            <div class="col-sm-3">
                                <img style="width: 200px;height: 200px;display: block;"
                                     src="" alt="未上传图片" id="travel_picture2">
                                <span class="btn-upload form-group mt-20">
                            <input type="file" name="p2" onchange="" style=""/>
                        </span>
                            </div>
                            <div class="col-sm-3">
                                <img style="width: 200px;height: 200px;display: block;"
                                     src="" alt="未上传图片" id="travel_picture3">
                                <span class="btn-upload form-group mt-20">
                            <input type="file" name="p3" onchange="" style=""/>
                        </span>
                            </div>
                            <div class="col-sm-3">
                                <img style="width: 200px;height: 200px;display: block;"
                                     src="" alt="未上传图片" id="travel_picture4">
                                <span class="btn-upload form-group mt-20">
                            <input type="file" name="p4" onchange="" style=""/>
                        </span>
                            </div>
                            <input type="button" class="btn btn-primary radius" onclick="uploadPicture(this);" style=""
                                   value="上传图片"/>
                        </div>
                    </div>
                </form>
                <form action="/dd_travel_war/fileUpload" enctype="multipart/form-data" id="form2">
                    <div class="row cl">
                        <label class="form-label col-xs-4 col-sm-2">日程pdf文件：</label>
                        <div class="formControls col-xs-8 col-sm-9">
                    <span class="btn-upload form-group">
                        <input type="file" name="pdf" onchange="" style=""/>
                    </span>
                            <br>
                            <input type="text" style="display: none;" id="schedules_pdf">
                            <input type="button" class="btn btn-primary radius" onclick="uploadPdf();" style=""
                                   value="上传日程pdf"/>
                        </div>
                    </div>
                </form>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">SEO标题：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="" id="seo_title" name="">
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">SEO关键字：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="" id="seo_key" name="">
                    </div>
                </div>
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">SEO描述：</label>
                    <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="" id="seo_desc" name="">
                    </div>
                </div>
                <div class="row cl">
                    <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
                        <button onClick="updateLineDetail();" class="btn btn-secondary radius" type="button"> 保存
                        </button>
                        <button onClick="layer_close();" class="btn btn-default radius" type="button">
                            取消
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="tabCon">
            <style>
                span {
                    display: inline-block;
                    padding: 10px;
                    cursor: pointer;
                }

                .input-info span {
                    width: 100px;
                }

                #days > span {
                    width: 30px;
                    height: 30px;
                }
                #header > span {
                    width: 30px;
                    height: 30px;
                }

                #days span:hover {
                    background-color: #148cf1;
                    color: #fff;
                }

                .active {
                    background-color: #148cf1;
                    color: #fff;
                }

                .item {
                    display: inline-block;
                    width: 280px;
                    line-height: 50px;
                }

                .calendar {
                    width: 350px;
                    border: 1px solid #a4a4a4;
                }

                #header {
                    border-bottom: 1px solid #a4a4a4;
                    background-color: #b72b36;
                    color: #d4d4d4;
                }
            </style>
            <div style="margin: 0 auto;width: 600px;">
                <div class="input-info">
                    <div class="item">
                        <span>年份：</span><input type="text" value="2018" id="year"></div>
                    <div class="item">
                        <span>月份：</span><input type="text" value="5" id="month"></div>

                    <div class="item">
                        <span>成人价格：</span><input type="text" id="plan_price"></div>
                    <div class="item">
                        <span>儿童价格：</span><input type="text" id="plan_child_price"></div>
                    <div class="item">
                        <span>集合地点：</span><input type="text" id="gather_place"></div>
                    <div class="item">
                        <span>解散地点：</span><input type="text" id="dismiss_place"></div>
                    <div class="item">
                        <button onclick="highlightDay()">生成日历</button>
                        <button onclick="lightAll();">全选</button>
                        <button onclick="darkAll();">取消全选</button>
                        <button onclick="addPlan()">生成班次</button>
                    </div>
                </div>
                <div class="calendar">
                    <div id="header"></div>
                    <div id="days"></div>
                </div>
            </div>
            <script>
                <!--根据传入的年月返回当月天数-->
                function getMonthDays(year, month) {
                    var d = new Date(year, month, 0);
                    return d.getDate();
                }

                function lightThis(o) {
                    var obj = $(o);
                    if (obj.hasClass('active')) {
                        obj.removeClass('active');
                        return;
                    }
                    obj.addClass('active');
                }

                //生成选中月份的表格
                function generate() {
                    var dayNum = getMonthDays($('#year').val(), $('#month').val());
                    var ins = '';

                    for (var i = 1; i <= dayNum; i++) {
                        ins +=
                            '<span onclick="lightThis(this)">' + i + '</span>';
                        if (i % 7 == 0) {
                            ins +=
                                '<br>';
                        }
                    }

                    $('#days').html(ins);

                }

                //month为实际月份数而非逻辑月份，new Date(2018, month, 0),获取的是month下标月的上个月最后一天，即month的真正的那个月份的最后一天，
                function highlightDay() {
                    var month = $('#month').val();
                    generate();//生成当前月的选项表
                    var spans = $('#days > span');
                    var data = new Date(2018, month - 1, 1);
                    var dayNum = (new Date(2018, month, 0)).getDate();//当前月的天数
                    data.setDate(1);//设置日期为当月第一天
                    console.log("really"+data);
                    console.log("现在日期" + (new Date()).getDay());
                    var firstFindDay;
                    var firstDay = data.getDay();//本月第一天星期值
                    firstDay = firstDay == 0 ? 7 : firstDay;//getDay周1到6返回1-6，周日返回0，所以把周日转换成7

                    //插入星期的信息
                    var insHeader = '';
                    for (var i = 0; i < 7; i++) {
                        //按照表格生成规则一定是一号在第一个位置，然后往后以此计算出其他位置的星期的值
                        insHeader +=
                            '<span onclick="lightLine(this)">周' + ((firstDay + i - 1) % 7 + 1) + '</span>'
                        $('#header').html(insHeader);
                    }
                }

                function lightLine(o) {
                    var lineNum = $(o).index();
                    $($('#days>span')[lineNum]).addClass('active');
                    $($('#days>span')[lineNum + 7]).addClass('active');
                    $($('#days>span')[lineNum + 14]).addClass('active');
                    $($('#days>span')[lineNum + 21]).addClass('active');
                    $($('#days>span')[lineNum + 28]).addClass('active');
                    $(o).attr('onclick', 'darkLine(this)');
                }

                function darkLine(o) {
                    var lineNum = $(o).index();
                    $($('#days>span')[lineNum]).removeClass('active');
                    $($('#days>span')[lineNum + 7]).removeClass('active');
                    $($('#days>span')[lineNum + 14]).removeClass('active');
                    $($('#days>span')[lineNum + 21]).removeClass('active');
                    $($('#days>span')[lineNum + 28]).removeClass('active');
                    $(o).attr('onclick', 'lightLine(this)');
                }

                function lightAll() {
                    var objs = $('#days>span');
                    objs.addClass('active');
                }

                function darkAll() {
                    var objs = $('#days>span');
                    objs.removeClass('active')

                }

                function addPlan() {
                    if(travelId==null||travelId==0) {
                        alert('未添加或添加基本信息失败');
                        return;
                    }
                    var dates = $('#days > span[class=active]');
                    var linePlans = [];
                    $(dates).each(function (index, item) {
                        var date = new Date($('#year').val(), $('#month').val()-1, $(item).text());
                        linePlans[index] = {
                            travelId: travelId,
                            startTime: date.Format("yyyy-MM-dd"),
                            planPrice: $('#plan_price').val(),
                            planChildPrice: $('#plan_child_price').val(),
                            gatherPlace: $('#gather_place').val(),
                            dismissPlace: $('#dismiss_place').val()
                        };
                    });
                    $.ajax({
                        type: 'post',
                        url: '/dd_travel_war/lineAdmin',
                        data: {
                            method: 'insertLinePlans',
                            jsonArray: JSON.stringify(linePlans)
                        },
                        dataType: 'json',
                        success: function (json) {
                            if (json.flag >= 1) {
                                alert(json.msg);
                            }

                        },
                        error: function (data) {
                            console.log(data.msg);
                        }
                    });


                }
            </script>
            <script>
                Date.prototype.Format = function (fmt) { //author:  
                    var o = {
                        "M+": this.getMonth() + 1, //月份 
                        "d+": this.getDate(), //日 
                        "h+": this.getHours(), //小时 
                        "m+": this.getMinutes(), //分 
                        "s+": this.getSeconds(), //秒 
                        "q+": Math.floor((this.getMonth() + 3) / 3), //季度 
                        "S": this.getMilliseconds() //毫秒 
                    };
                    if (/(y+)/.test(fmt)) {
                        fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
                    }
                    for (var k in o)
                        if (new RegExp("(" + k + ")").test(fmt))
                            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                    return fmt;

                }

                function toAddSchedules() {
                    var travelId = getUrlParam('id');
                    window.location.href = './line-schedule-add.html?id=' + travelId;
                }

                $(function () {
                    highlightDay();
                    $('#days').click(function () {

                    })

                })
            </script>
        </div>
        <div class="tabCon">
            <script src="./js/line-schedule.js"></script>
            <button class="btn btn-primary mt-20" onclick="generateScheduleList()">创建行程</button>
            <div id="schedules-area"></div>
        </div>
    </div>

</div>

<script type="text/javascript">
    var travelId;
    <!--定义选项卡函数-->
    jQuery.Huitab = function (tabBar, tabCon, class_name, tabEvent, i) {
        var $tab_menu = $(tabBar);
        // 初始化操作
        $tab_menu.removeClass(class_name);
        $(tabBar).eq(i).addClass(class_name);
        $(tabCon).hide();
        $(tabCon).eq(i).show();

        $tab_menu.bind(tabEvent, function () {
            $tab_menu.removeClass(class_name);
            $(this).addClass(class_name);
            var index = $tab_menu.index(this);
            $(tabCon).hide();
            $(tabCon).eq(index).show()
        })
    }

    $(function () {
        //初始化选项卡
        $.Huitab("#tab_demo .tabBar span", "#tab_demo .tabCon", "current", "click", "0")
    })
</script>

</body>
</html>